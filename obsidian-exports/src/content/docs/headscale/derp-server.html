<!DOCTYPE html> <html lang="en"><head>
<title>Custom DERP Server</title>
<base href="../../../..">
<meta name="pathname" content="src/content/docs/headscale/derp-server.html">
<meta name="description" content="A guide for setting up a Tailscale DERP server in non-standard conditions">
<meta property="og:title" content="Custom DERP Server">
<meta property="og:description" content="A guide for setting up a Tailscale DERP server in non-standard conditions">
<meta property="og:type" content="website">
<meta property="og:url" content="src/content/docs/headscale/derp-server.html">
<meta property="og:image" content="src/assets/npm1.jpg">
<meta charset="UTF-8"><meta property="og:site_name" content="binder-badge.github.io"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="site-lib/rss.xml"><script async="" id="webpage-script" src="site-lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-wasm-script" src="site-lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="site-lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="site-lib/media/favicon.png"><link rel="stylesheet" href="site-lib/styles/obsidian.css"><link rel="preload" href="site-lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="site-lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-vertical-spacing:1.3em;--sidebar-margin:12px}:root{background-color:#202124}.sidebar{height:100%;font-size:14px;z-index:10;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));position:relative;overflow:hidden;overflow:clip;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}#left-sidebar{left:0}#right-sidebar{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}.sidebar.floating{position:absolute}.sidebar .leaf-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .leaf-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}#left-sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}#right-sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar #left-sidebar-content,.sidebar #right-sidebar-content{contain:none!important;container-type:normal!important;animation:none!important}.sidebar:has(.leaf-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:calc(2.3em + 2 * var(--sidebar-margin));width:var(--sidebar-width);padding:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}#left-sidebar .sidebar-topbar{left:0;flex-direction:row;border-top-right-radius:var(--radius-l)}#right-sidebar .sidebar-topbar{right:0;flex-direction:row-reverse;border-top-left-radius:var(--radius-l)}#left-sidebar .topbar-content{margin-right:calc(2.3em + var(--sidebar-margin));flex-direction:row}#right-sidebar .topbar-content{margin-left:calc(2.3em + var(--sidebar-margin));flex-direction:row-reverse}.topbar-content{overflow:hidden visible;overflow:clip visible;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:2px!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}#left-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}#right-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.feature-title{margin-left:1px;text-transform:uppercase;letter-spacing:.06em;margin-top:.75em;margin-bottom:.75em}.feature-header{display:flex;align-items:center;padding-top:0;font-size:1em;padding-left:0}body.floating-sidebars .sidebar{position:absolute}body{transition:background-color var(--color-fade-speed) ease-in-out}#navbar:not(:empty){display:flex;align-items:center;justify-content:space-between;padding:.5em 1em;width:100%}#main{display:flex;flex-direction:column;height:100%;width:100%;align-items:stretch;justify-content:center}#main-horizontal{display:flex;flex-direction:row;flex-grow:1;width:100%;align-items:stretch;justify-content:center}#center-content{flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0!important;transition:opacity .2s ease-in-out;pointer-events:none}#center-content>.obsidian-document{padding-left:2em;padding-right:1em;margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}body #center-content>.obsidian-document>.markdown-preview-sizer{padding-bottom:80vh;width:100%;max-width:var(--line-width);flex-basis:var(--line-width);transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document>div{width:100%!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document:not([data-type=markdown]).embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}#center-content>.obsidian-document:not([data-type=markdown]).embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6,li):has(> :is(.math,table)){overflow-x:auto!important}#center-content>.obsidian-document:not([data-type=markdown]){overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.obsidian-document[data-type=attachment]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.obsidian-document[data-type=attachment]>*{outline:0;border:none;box-shadow:none}.obsidian-document[data-type=attachment] :is(img){max-width:90%;max-height:90%;object-fit:contain}.obsidian-document[data-type=attachment]>:is(audio){width:100%;max-width:min(90%,var(--line-width))}.obsidian-document[data-type=attachment]>:is(embed,iframe,video){width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain}.canvas-wrapper>:is(.header,.footer){z-index:100;position:absolute;display:flex;justify-content:center;flex-direction:column;width:100%;align-items:center}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){let e=document.querySelectorAll("link[itemprop='include']");for(const t of e){let e=t.getAttribute("href");try{let o="";if(e.startsWith("https:")||e.startsWith("http:")||"file:"!=window.location.protocol){const n=await fetch(e);if(!n.ok){console.log("Could not include file: "+e),t?.remove();continue}o=await n.text()}else{const t=document.getElementById(btoa(encodeURI(e)));if(t){const e=JSON.parse(decodeURI(atob(t.getAttribute("value")??"")));o=e?.data??""}}let n=document.createRange().createContextualFragment(o);t.before(n),t.remove(),console.log("Included text: "+o),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script")));!function e(n){let l=o[n],c=n+1;l?(l&&"true"!=l.getAttribute("loaded")||n<o.length&&e(c),n<o.length&&l.addEventListener("load",(()=>e(c)))):n<o.length?e(c):t()}(0)}</script></head><body class="publish css-settings-manager show-inline-title show-ribbon is-focused"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="parsed-feature-container" style="display: contents;"><link itemprop="include" href="site-lib/html/custom-head-content-content.html"></div><div id="main"><div id="navbar"></div><div id="main-horizontal"><div id="left-content" class="leaf" style="--sidebar-width: var(--sidebar-width-left);"><div id="left-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><div id="search-container"><div id="search-wrapper"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div aria-label="Clear search" id="search-clear-button"></div></div></div></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="left-sidebar-content" class="leaf-content"><link itemprop="include" href="site-lib/html/file-tree-content.html"></div></div><script defer="">let ls = document.querySelector("#left-sidebar"); ls.classList.toggle("is-collapsed", window.innerWidth < 768); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div></div><div id="center-content" class="leaf"><div class="obsidian-document markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings allow-fold-lists show-indentation-guide show-properties" data-type="markdown"><style id="MJX-CHTML-styles"></style><pre class="frontmatter language-yaml" tabindex="0" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">title</span><span class="token punctuation">:</span> Custom DERP Server
<span class="token key atrule">description</span><span class="token punctuation">:</span> A guide for setting up a Tailscale DERP server in non<span class="token punctuation">-</span>standard conditions</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre><div class="markdown-preview-sizer markdown-preview-section"><div class="header"><h1 class="page-title heading inline-title" id="Custom_DERP_Server_0">Custom DERP Server</h1><div class="data-bar"></div></div><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-h2"><h2 data-heading="What is this for?" dir="auto" class="heading" id="What_is_this_for?_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>What is this for?</h2></div><div class="el-p"><p dir="auto">This guide is for people who want to run their own DERP server for their Tailscale network (Tailnet) or for their own self-hosted Headscale Tailnet. This guide will go over how to setup a custom DERP relay for Tailscale in certain conditions. You will be able to setup a DERP relay using a non-standard HTTPS port or behind a reverse proxy. The DERP relay that will be used is <a data-tooltip-position="top" aria-label="https://github.com/fredliang44/derper-docker" rel="noopener nofollow" class="external-link is-unresolved" href="https://github.com/fredliang44/derper-docker" target="_self">fredliang/derper</a></p></div><div class="el-h2"><h2 data-heading="Requirements" dir="auto" class="heading" id="Requirements_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Requirements</h2></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>A Linux server with Docker to host a DERP relay on</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>A domain or dedicated subdomain pointed towards the server </li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>The ability to expose ports on your server to the internet</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>Prior knowledge on configuring and managing remote servers</li>
</ul></div><div class="el-h2"><h2 data-heading="Non-Standard HTTPS port" dir="auto" class="heading" id="Non-Standard_HTTPS_port_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Non-Standard HTTPS port</h2></div><div class="el-p"><p dir="auto">You may already have a public server that you have lying around, but it has ports 80 and 443 taken up by a reverse proxy like NGINX or Traefik. In my case, I have a public VPS to host some simple Docker services like Gotify and PsiTransfer. Those services are behind <a data-tooltip-position="top" aria-label="https://github.com/ZoeyVid/NPMplus" rel="noopener nofollow" class="external-link is-unresolved" href="https://github.com/ZoeyVid/NPMplus" target="_self">Nginx Proxy Manager+</a> and using that for TLS and fun wildcard domains. </p></div><div class="el-p"><p dir="auto">No worries! You can host the DERP relay on a non-standard HTTPS port. It's relatively simple. </p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Make a new folder for the DERP relay and enter it</li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token function">mkdir</span> derper <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> derper
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol start="2">
<li data-line="0" dir="auto">Add a folder to the DERP relay folder</li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token function">mkdir</span> certs
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol start="3">
<li data-line="0" dir="auto">Make a <code>docker-compose.yaml</code> and open it</li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token function">touch</span> docker-compose.yml
<span class="token function">nano</span> docker-compose.yml
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol start="4">
<li data-line="0" dir="auto">Edit <code>docker-compose.yaml</code> to have this text</li>
</ol></div><div class="el-pre"><pre class="language-yaml" tabindex="0"><code data-line="0" class="language-yaml is-loaded"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">derper</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> fredliang/derper
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> derper
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 3478<span class="token punctuation">:</span>3478/udp
      <span class="token punctuation">-</span> 8443<span class="token punctuation">:</span><span class="token number">443</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> DERP_DOMAIN=derp.domain
      <span class="token punctuation">-</span> DERP_ADDR=<span class="token punctuation">:</span><span class="token number">443</span>
      <span class="token punctuation">-</span> DERP_HTTP_PORT=<span class="token punctuation">-</span><span class="token number">1</span>
      <span class="token punctuation">-</span> DERP_CERT_MODE=manual
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./certs/fullchain.pem<span class="token punctuation">:</span>/app/certs/derp.domain.crt<span class="token punctuation">:</span>ro
      <span class="token punctuation">-</span> ./certs/privkey.pem<span class="token punctuation">:</span>/app/certs/derp.domain.key<span class="token punctuation">:</span>ro
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Don't forget to change <code>derp.domain</code> to the domain or subdomain you have setup for the server. If needed, change port 8443 to some other non-standard port. </li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>You will need to expose the non-standard HTTPS port and STUN port. You may need to go to your server provider's firewall to open the port as well as on the server itself. </li>
</ul></div><div class="el-ol"><ol start="5">
<li data-line="0" dir="auto">
<p>Get Let's Encrypt HTTPS certificates for your domain.<br>
You'll need an A record on your DNS provider that points your domain or subdomain to your server's IP. After that, you run a tool like Certbot to grab a certificate for your domain using the HTTP-01 challenge. Make sure that the server has ports 80 and 443 open. Once you get your certificates, you can point the volumes in <code>docker-compose.yml</code> to the location of your <code>fullchain.pem</code> and <code>privkey.pem</code> or paste your certificates into your <code>certs</code> folder. </p>
</li>
<li data-line="3" dir="auto">
<p>Spin up the DERP relay!</p>
</li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="Behind a reverse proxy" dir="auto" class="heading" id="Behind_a_reverse_proxy_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Behind a reverse proxy</h2></div><div class="el-p"><p dir="auto">You can also host a DERP relay behind your reverse proxy and run it behind ports 80 and 443.<br>
This guide will go over setting up a DERP relay behind <a data-tooltip-position="top" aria-label="https://github.com/ZoeyVid/NPMplus" rel="noopener nofollow" class="external-link is-unresolved" href="https://github.com/ZoeyVid/NPMplus" target="_self">Nginx Proxy Manager+</a></p></div><div class="el-h3"><h3 data-heading="How does this work?" dir="auto" class="heading" id="How_does_this_work?_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>How does this work?</h3></div><div class="el-p"><p dir="auto">Normally, the DERP port will be 443 and you will be forced to use TLS, which usually doesnt work well with reverse proxies, which people usually use to handle TLS to their services.<br>
However, if you use 80 as the DERP port, it will not use TLS, and serve normal HTTP. This would allow the reverse proxy to take over, and allow it to handle TLS for the DERP relay. </p></div><div class="el-h3"><h3 data-heading="Setting up Nginx Proxy Manager+ (NPM+)" dir="auto" class="heading" id="Setting_up_Nginx_Proxy_Manager+_(NPM+)_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Setting up Nginx Proxy Manager+ (NPM+)</h3></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Make a new folder for NPM+ and enter it</li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token function">mkdir</span> npm-plus <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> npm-plus
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol start="2">
<li data-line="0" dir="auto">Add a <code>data</code> folder to the NPM+ folder</li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token function">mkdir</span> data
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol start="3">
<li data-line="0" dir="auto">Make a <code>docker-compose.yaml</code> and open it</li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token function">touch</span> docker-compose.yml
<span class="token function">nano</span> docker-compose.yml
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol start="4">
<li data-line="0" dir="auto">Edit <code>docker-compose.yaml</code> to have this text</li>
</ol></div><div class="el-pre"><pre class="language-yaml" tabindex="0"><code data-line="0" class="language-yaml is-loaded"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">npmplus</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> npmplus
    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.io/zoeyvid/npmplus<span class="token punctuation">:</span>latest <span class="token comment"># or ghcr.io/zoeyvid/npmplus:latest</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> proxy
    <span class="token key atrule">dns</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 1.1.1.1
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token datetime number">80:80</span>
      <span class="token punctuation">-</span> 443<span class="token punctuation">:</span><span class="token number">443</span>
      <span class="token punctuation">-</span> <span class="token datetime number">81:81</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"./data:/data"</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"TZ=America/Chicago"</span> <span class="token comment"># set timezone, required, set it to one of the values from the "TZ identifier" https://en.wikipedia.org/wiki/List_of_tz_database_time_zones#List</span>
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">proxy</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>You will need to expose the ports 80 and 443. You may need to go to your server provider's firewall to open the port as well as on the server itself. </li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>Port 81 will also have to be exposed for NPM+'s admin panel. You can setup the panel behind a domain or subdomain and not need to expose port 81. </li>
</ul></div><div class="el-ol"><ol start="5">
<li data-line="0" dir="auto">Create a Docker network for NPM+</li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token function">docker</span> network create proxy
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol start="6">
<li data-line="0" dir="auto">Spin up NPM+</li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol start="7">
<li data-line="0" dir="auto">Return to the starting folder </li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="Setting up the DERP relay" dir="auto" class="heading" id="Setting_up_the_DERP_relay_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Setting up the DERP relay</h3></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Make a new folder for the DERP relay and enter it</li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token function">mkdir</span> derper <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> derper
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol start="2">
<li data-line="0" dir="auto">Make a <code>docker-compose.yaml</code> and open it</li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token function">touch</span> docker-compose.yml
<span class="token function">nano</span> docker-compose.yml
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol start="3">
<li data-line="0" dir="auto">Edit <code>docker-compose.yaml</code> to have this text</li>
</ol></div><div class="el-pre"><pre class="language-yaml" tabindex="0"><code data-line="0" class="language-yaml is-loaded"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">derper</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> fredliang/derper
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> derper
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 3478<span class="token punctuation">:</span>3478/udp
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> proxy
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> DERP_DOMAIN=derp.friendlyguy.casacam.net
      <span class="token punctuation">-</span> DERP_ADDR=<span class="token punctuation">:</span><span class="token number">80</span>
      <span class="token punctuation">-</span> DERP_HTTP_PORT=80
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">proxy</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Don't forget to change <code>derp.domain</code> to the domain or subdomain you have setup for the server.  </li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>You will need to expose the STUN port. You may need to go to your server provider's firewall to open the port as well as on the server itself. </li>
</ul></div><div class="el-ol"><ol start="4">
<li data-line="0" dir="auto">Spin up the DERP relay!</li>
</ol></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="Configuring NPM+ for the DERP relay" dir="auto" class="heading" id="Configuring_NPM+_for_the_DERP_relay_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Configuring NPM+ for the DERP relay</h3></div><div class="el-p"><p dir="auto">This assumes you've completed the first time setup for NPM+ and can access the admin panel. </p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Add a new <code>Proxy Host</code></li>
</ol></div><div class="el-p"><p dir="auto"><span src="src/assets/npm1.jpg" class="internal-embed media-embed image-embed is-loaded" target="_self"><img src="src/assets/npm1.jpg" target="_self"></span> </p></div><div class="el-ol"><ol start="2">
<li data-line="0" dir="auto">On the <code>Details</code> tab</li>
</ol></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Add your DERP domain or subdomain to your <code>Domain Names</code></li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>Set the <code>Domain/IP + optional path</code> to <code>derper</code></li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>Set the <code>Port</code> to 80</li>
</ul></div><div class="el-p"><p dir="auto"><span src="src/assets/npm2.jpg" class="internal-embed media-embed image-embed is-loaded" target="_self"><img src="src/assets/npm2.jpg" target="_self"></span> </p></div><div class="el-ol"><ol start="3">
<li data-line="0" dir="auto">On the <code>TLS</code> tab</li>
</ol></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Request a new certificate</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>Agree to Let's Encrypt Terms of Service</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>Force HTTPS</li>
</ul></div><div class="el-p"><p dir="auto"><span src="src/assets/npm3.jpg" class="internal-embed media-embed image-embed is-loaded" target="_self"><img src="src/assets/npm3.jpg" target="_self"></span> </p></div><div class="el-ol"><ol start="4">
<li data-line="0" dir="auto">Save the configuration</li>
</ol></div><div class="el-h2"><h2 data-heading="Testing connectivity to the DERP server" dir="auto" class="heading" id="Testing_connectivity_to_the_DERP_server_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Testing connectivity to the DERP server</h2></div><div class="el-p"><p dir="auto">This assumes you have Tailscale installed on your client and can use the Tailsclae CLI.<br>
To add your DERP server to your Tailnet, you can follow the steps provided by Tailscale <a data-tooltip-position="top" aria-label="https://tailscale.com/kb/1118/custom-derp-servers#add-the-custom-derp-servers-to-your-tailnet" rel="noopener nofollow" class="external-link is-unresolved" href="https://tailscale.com/kb/1118/custom-derp-servers#add-the-custom-derp-servers-to-your-tailnet" target="_self">here</a>.<br>
Once you have added it to your Tailnet policy, you can test connectivity to your DERP relay using <code>tailscale debug derp &lt;region-id&gt;</code>.<br>
An successful DERP connection will look something like this. </p></div><div class="el-pre"><pre class="language-json" tabindex="0"><code data-line="0" class="language-json is-loaded"><span class="token punctuation">{</span>
 <span class="token property">"Info"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">"Region 998 == \"random-vps-derp\""</span><span class="token punctuation">,</span>
  <span class="token string">"Successfully established a DERP connection with node \"derp.domain.com\""</span><span class="token punctuation">,</span>
  <span class="token string">"Node \"derp.domain.com\" returned IPv4 STUN response: client-ip:41017"</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token property">"Warnings"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
 <span class="token property">"Errors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">"Error connecting to node \"derp.domain.com\" @ \"derp.domain.com:443\" over IPv6: dial tcp6: lookup derp.domain.com on 127.0.0.53:53: no such host"</span>
 <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">I got an error as I don't have an IPv6 IP for my domain. The DERP server works regardless of that error. </p></div><div class="el-p"><p dir="auto">You can also test latency to your DERP server using <code>tailscale netcheck</code> and viewing the resultant report. </p></div><div class="el-pre"><pre><code data-line="0">Report:
	* Time: 2025-08-01T20:14:54.12745344Z
	* UDP: true
	* IPv4: yes, client-ip:40784
	* IPv6: no, but OS has support
	* MappingVariesByDestIP: false
	* PortMapping: UPnP, NAT-PMP
	* Nearest DERP: &lt;obfuscated for privacy&gt;
	* DERP latency:
		- random-vps-derp: 36.3ms  (random-vps)
        ...
        &lt;other relay servers&gt;
        ...
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">You can also run <code>tailscale debug derp-map</code> in order to get an list of all available DERP servers for your Tailnet. Your DERP server should look like this</p></div><div class="el-pre"><pre class="language-json" tabindex="0"><code data-line="0" class="language-json is-loaded"><span class="token property">"998"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">"RegionID"</span><span class="token operator">:</span> <span class="token number">998</span><span class="token punctuation">,</span>
			<span class="token property">"RegionCode"</span><span class="token operator">:</span> <span class="token string">"random-vps-derp"</span><span class="token punctuation">,</span>
			<span class="token property">"RegionName"</span><span class="token operator">:</span> <span class="token string">"random-vps"</span><span class="token punctuation">,</span>
			<span class="token property">"Nodes"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
				<span class="token punctuation">{</span>
					<span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"998"</span><span class="token punctuation">,</span>
					<span class="token property">"RegionID"</span><span class="token operator">:</span> <span class="token number">998</span><span class="token punctuation">,</span>
					<span class="token property">"HostName"</span><span class="token operator">:</span> <span class="token string">"derp.domain.com"</span><span class="token punctuation">,</span>
					<span class="token property">"IPv4"</span><span class="token operator">:</span> <span class="token string">"server.ip"</span><span class="token punctuation">,</span>
					<span class="token property">"STUNPort"</span><span class="token operator">:</span> <span class="token number">3478</span><span class="token punctuation">,</span>
					<span class="token property">"DERPPort"</span><span class="token operator">:</span> <span class="token number">443</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">]</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="footer"><div class="data-bar"></div></div></div></div></div><div id="right-content" class="leaf" style="--sidebar-width: var(--sidebar-width-right);"><div id="right-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme-toggle-input" id=""><input class="theme-toggle-input" type="checkbox" id="theme-toggle-input"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="right-sidebar-content" class="leaf-content"><div class="graph-view-wrapper"><div class="feature-header"><div class="feature-title">Interactive Graph</div></div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<div class="graph-icon graph-global" role="button" aria-label="Global Graph" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-git-fork"><circle cx="12" cy="18" r="3"></circle><circle cx="6" cy="6" r="3"></circle><circle cx="18" cy="6" r="3"></circle><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"></path><path d="M12 12v3"></path></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div id="outline" class=" tree-container"><div class="feature-header"><div class="feature-title">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="src/content/docs/headscale/derp-server.html#Custom_DERP_Server_0" data-path="#Custom_DERP_Server_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Custom DERP Server">Custom DERP Server</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="src/content/docs/headscale/derp-server.html#What_is_this_for?_0" data-path="#What_is_this_for?_0"><div class="tree-item-inner heading-link" heading-name="What is this for?">What is this for?</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="src/content/docs/headscale/derp-server.html#Requirements_0" data-path="#Requirements_0"><div class="tree-item-inner heading-link" heading-name="Requirements">Requirements</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="src/content/docs/headscale/derp-server.html#Non-Standard_HTTPS_port_0" data-path="#Non-Standard_HTTPS_port_0"><div class="tree-item-inner heading-link" heading-name="Non-Standard HTTPS port">Non-Standard HTTPS port</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="src/content/docs/headscale/derp-server.html#Behind_a_reverse_proxy_0" data-path="#Behind_a_reverse_proxy_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Behind a reverse proxy">Behind a reverse proxy</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="src/content/docs/headscale/derp-server.html#How_does_this_work?_0" data-path="#How_does_this_work?_0"><div class="tree-item-inner heading-link" heading-name="How does this work?">How does this work?</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="src/content/docs/headscale/derp-server.html#Setting_up_Nginx_Proxy_Manager+_(NPM+)_0" data-path="#Setting_up_Nginx_Proxy_Manager+_(NPM+)_0"><div class="tree-item-inner heading-link" heading-name="Setting up Nginx Proxy Manager+ (NPM+)">Setting up Nginx Proxy Manager+ (NPM+)</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="src/content/docs/headscale/derp-server.html#Setting_up_the_DERP_relay_0" data-path="#Setting_up_the_DERP_relay_0"><div class="tree-item-inner heading-link" heading-name="Setting up the DERP relay">Setting up the DERP relay</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="src/content/docs/headscale/derp-server.html#Configuring_NPM+_for_the_DERP_relay_0" data-path="#Configuring_NPM+_for_the_DERP_relay_0"><div class="tree-item-inner heading-link" heading-name="Configuring NPM+ for the DERP relay">Configuring NPM+ for the DERP relay</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="src/content/docs/headscale/derp-server.html#Testing_connectivity_to_the_DERP_server_0" data-path="#Testing_connectivity_to_the_DERP_server_0"><div class="tree-item-inner heading-link" heading-name="Testing connectivity to the DERP server">Testing connectivity to the DERP server</div></a><div class="tree-item-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector("#right-sidebar"); rs.classList.toggle("is-collapsed", window.innerWidth < 768); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></div></div></body></html>